//
//  FormTableDelegate.m
//  MySampleApp
//
//
// Copyright 2017 Amazon.com, Inc. or its affiliates (Amazon). All Rights Reserved.
//
// Code generated by AWS Mobile Hub. Amazon gives unlimited permission to 
// copy, distribute and modify it.
//
// Source code generated from template: aws-my-sample-app-ios-objc v0.20
//
//

#import "FormTableDelegate.h"

@interface FormTableDelegate()

@property (strong, atomic) NSMutableArray<FormTableCell *> *cells;

@end

@implementation FormTableDelegate

- (instancetype)init {
    if (self = [super init]) {
        _cells = [NSMutableArray new];
    }
    return self;
}

-(NSUInteger)numberOfCells {
    return self.cells.count;
}

-(void)addCell:(FormTableCell *)cell {
    [self.cells addObject:cell];
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    [tableView deselectRowAtIndexPath:indexPath
                             animated:NO];
    TableInputCell *currentCell = (TableInputCell *)[tableView cellForRowAtIndexPath:indexPath];
    [currentCell onTap];
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return self.numberOfCells;
}

- (void)showPassword:(UIButton *)button {
    UITextField *textField = (UITextField *)[button superview];
    if (textField.isSecureTextEntry) {
        textField.secureTextEntry = NO;
        [button setTitle:@"Hide" forState:UIControlStateNormal];
    } else {
        textField.secureTextEntry = YES;
        [button setTitle:@"Show" forState:UIControlStateNormal];
    }
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    TableInputCell *inputCell = (TableInputCell *)[tableView dequeueReusableCellWithIdentifier:@"FormTableCell"
                                                           forIndexPath:indexPath];
    FormTableCell *formCell = self.cells[indexPath.row];
    
    inputCell.placeHolderLabel.text = formCell.placeHolder;
    inputCell.headerLabel.text = [formCell.placeHolder uppercaseString];
    inputCell.inputBox.autocorrectionType = UITextAutocorrectionTypeNo;
    inputCell.inputBox.spellCheckingType = UITextSpellCheckingTypeNo;
    if (formCell.inputType == InputTypePassword) {
        inputCell.inputBox.secureTextEntry = YES;
        UIButton *showButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 40, 20)];
        [showButton setTitle:@"Show" forState:UIControlStateNormal];
        [showButton addTarget:self
                       action:@selector(showPassword:)
             forControlEvents:UIControlEventTouchUpInside];
        inputCell.inputBox.rightViewMode = UITextFieldViewModeAlways;
        inputCell.inputBox.rightView = showButton;
        showButton.titleLabel.font = [UIFont systemFontOfSize:14.0];
        [showButton setTitleColor:[UIColor darkGrayColor]
                         forState:UIControlStateNormal];
    }
    if (formCell.inputType == InputTypeStaticText) {
        inputCell.placeHolderView.hidden = YES;
        inputCell.inputBox.text = formCell.staticText;
    }
    return inputCell;
}

- (NSString *)getValueForCell:(FormTableCell *)cell
                 forTableView:(UITableView *)tableView {
    NSInteger position = (NSInteger)[self.cells indexOfObject:cell];
    NSIndexPath *indexPath = [NSIndexPath indexPathForItem:position inSection:0];
    TableInputCell *inputCell = (TableInputCell *)[tableView cellForRowAtIndexPath:indexPath];
    return inputCell.inputBox.text;
    
}

- (TableInputCell *)getTableInputCell:(FormTableCell *)cell
                         forTableView:(UITableView *)tableView {
    NSInteger position = (NSInteger)[self.cells indexOfObject:cell];
    NSIndexPath *indexPath = [NSIndexPath indexPathForItem:position inSection:0];
    TableInputCell *inputCell = (TableInputCell *)[tableView cellForRowAtIndexPath:indexPath];
    return inputCell;
}

@end
